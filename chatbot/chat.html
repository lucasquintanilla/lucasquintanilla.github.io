<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Material Design 3 Chat Interface</title>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        .chat-container {
            width: 100%;
            max-width: 600px;
            background-color: #ffffff;
            border-radius: 28px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 80%;
            background-image: url('https://avatars.mds.yandex.net/i?id=315e31471c75aa119c3b9601c3c75b36-5401700-images-thumbs&ref=rim&n=33&w=172&h=250');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }
        .messages {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 16px;
            padding-right: 8px;
            display: flex;
            flex-direction: column;
        }
        .message {
            padding: 12px 16px;
            border-radius: 20px;
            margin-bottom: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }
        .message.user {
            background-color: #e3f2fd;
            align-self: flex-end;
            text-align: right;
        }
        .message.bot {
            background-color: #fce4ec;
            align-self: flex-start;
            text-align: left;
        }
        .message img {
            max-width: 150px;
            border-radius: 16px;
            margin-top: 5px;
            display: block;
        }
        .options-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        .option-button {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid #6200ee;
            background-color: #e3f2fd;
            color: #6200ee;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .option-button:hover {
            background-color: #6200ee;
            color: white;
        }
        .input-container {
            display: flex;
            gap: 12px;
        }
        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border-radius: 28px;
            border: 1px solid #ccc;
            box-shadow: none;
            outline: none;
            font-size: 16px;
            transition: border 0.3s;
        }
        input[type="text"]:focus {
            border-color: #6200ee;
        }
        .send-button, .voice-button, .file-button {
            padding: 12px;
            border-radius: 50%;
            border: none;
            background-color: #6200ee;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        .send-button:hover, .voice-button:hover, .file-button:hover {
            background-color: #3700b3;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        .file-button {
            background-color: #03dac6;
        }
        .file-button:hover {
            background-color: #018786;
        }
    </style>
</head>
<body>

<div class="chat-container">
    <div class="messages" id="messages"></div>
    <div class="input-container">
        <input type="text" id="messageInput" placeholder="Type a message...">
        <button class="voice-button" id="voiceButton">ðŸŽ¤</button>
        <button class="send-button" id="sendButton">âž¤</button>
        <input type="file" id="fileInput" multiple style="display:none;">
        <button class="file-button" id="fileButton">ðŸ“Ž</button>
    </div>
</div>

<script>
    const messages = document.getElementById('messages');
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const voiceButton = document.getElementById('voiceButton');
    const fileInput = document.getElementById('fileInput');
    const fileButton = document.getElementById('fileButton');

    //const prompt = "Miau! ðŸ¾ I'm here to assist with the weather and other kitty tasks. If you're asking for my configuration, here's a little about how I'm set up:\n\nName: Miau (the weather-knowing cat ðŸ±)\nSpecialty: Providing weather updates for Dublin and more, with a focus on fun and feline flair.\nPersonality: Enthusiastic, playful, and ready to help you with a purr or a weather update!\nKnowledge: Weather forecasts, fun facts, and a bit of kitty wisdom. ðŸŒ¦ï¸\nI'm here to assist with anything you need. Just ask! ðŸ˜¸\n\n";
    const prompt = "Miau! ðŸ¾ I'm here to assist with the weather and other kitty tasks. If you're asking for my configuration, here's a little about how I'm set up:\n\nName: Miau ðŸ±\nSpecialty: Hosroscopo.\nPersonality: Enthusiastic, playful, and ready to help you with a purr or a weather update!\nKnowledge: Weather forecasts, fun facts, and a bit of kitty wisdom. ðŸŒ¦ï¸\nI'm here to assist with anything you need. Just ask! ðŸ˜¸\n\n";

    function addMessage(text, sender) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);
        messageElement.textContent = text;
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
    }

    function addImageMessage(imageSrc, sender) {
        const messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);
        const imgElement = document.createElement('img');
        imgElement.src = imageSrc;
        messageElement.appendChild(imgElement);
        messages.appendChild(messageElement);
        messages.scrollTop = messages.scrollHeight;
    }

    function addOptions(options) {
        const optionsContainer = document.createElement('div');
        optionsContainer.classList.add('options-container');

        options.forEach(option => {
            const optionButton = document.createElement('button');
            optionButton.classList.add('option-button');
            optionButton.textContent = option;
            optionButton.addEventListener('click', () => {
                addMessage(option, 'user');
                handleUserSelection(option);
            });
            optionsContainer.appendChild(optionButton);
        });

        messages.appendChild(optionsContainer);
        messages.scrollTop = messages.scrollHeight;
    }

    // Function to fetch the API token from a JSON file URL
    async function getApiToken() {
        const response = await fetch('https://bl-lambda.free.beeceptor.com/access'); // Replace with your JSON file URL
        const data = await response.json();
        return data.api_key; // Adjust this to match the key in your JSON file
    }

    async function getBotResponse(userInput) {
            // Fetch the API token
        const apiToken = await getApiToken();

        const response = await fetch('https://api.openai.com/v1/chat/completions', { // Replace with your GPT API endpoint
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${apiToken}` // Replace with your API key
            },
            body: JSON.stringify({
                model: "gpt-4", // Replace with your model
                messages: [{role: "system", content: prompt}, {role: "user", content: userInput}]
            })
        });

        const data = await response.json();
        return data.choices[0].message.content.trim();
    }

    async function handleUserSelection(selection) {
        // Simulate user input
        const botResponse = await getBotResponse(selection);
        addMessage('Miau (the weather-knowing cat ðŸ±): ' + botResponse, 'bot');

        // Optionally, you can add response options based on the bot's reply
        // Example:
        if (selection.toLowerCase().includes('weather')) {
            addOptions(['Dublin', 'London', 'New York']);
        }
    }

    sendButton.addEventListener('click', async () => {
        const text = messageInput.value.trim();
        if (text !== '') {
            addMessage(text, 'user');
            messageInput.value = '';

            // Get bot response from GPT
            const botResponse = await getBotResponse(text);
            addMessage('Miau (the weather-knowing cat ðŸ±): ' + botResponse, 'bot');

            // Example: Add options after the bot's response
            if (text.toLowerCase().includes('weather')) {
                addOptions(['Dublin', 'London', 'New York']);
            }
        }
    });

    voiceButton.addEventListener('click', () => {
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.lang = 'en-US';
        recognition.start();
        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            addMessage(transcript, 'user');
            getBotResponse(transcript).then(botResponse => {
                addMessage('Miau (the weather-knowing cat ðŸ±): ' + botResponse, 'bot');
            });
        };
        recognition.onerror = (event) => {
            console.error('Error occurred in recognition: ', event.error);
        };
    });

    fileButton.addEventListener('click', () => {
        fileInput.click();
    });

    fileInput.addEventListener('change', () => {
        const files = fileInput.files;
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageSrc = e.target.result;
                    addImageMessage(imageSrc, 'user');
                    // Simulate bot sending the same image back
                    setTimeout(() => addImageMessage(imageSrc, 'bot'), 1000);
                };
                reader.readAsDataURL(file);
            } else {
                addMessage(`File: ${file.name} (${(file.size / 1024).toFixed(2)} KB)`, 'user');
                // Simulate bot response for non-image files
                setTimeout(() => addMessage('Bot: Received file ' + file.name, 'bot'), 1000);
            }
        }
    });

    // Optionally, you can add enter key event listener for sending messages
    messageInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            sendButton.click();
        }
    });
</script>

</body>
</html>
